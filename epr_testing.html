<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EPR Resonance + ZFS Diagram</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .container { display: flex; gap: 30px; }
    .panel { width: 320px; }
    input { width: 100px; }
  </style>
</head>
<body>
<h2>EPR Resonance Calculator (with Unit Selection)</h2>
<div class="panel">
  <label>g-value: <input id="gval" type="number" value="2.0023" step="0.0001"></label><br><br>
  <label>Frequency (GHz): <input id="freq" type="number" value="9.5" step="0.01"></label><br><br>
  <label>Magnetic Field: <input id="bfield" type="number" value="340" step="1"></label>
  <select id="bunits">
    <option value="mT">mT</option>
    <option value="G">G</option>
    <option value="T">T</option>
  </select><br><br>
  <button onclick="solveFor('g')">Solve g</button>
  <button onclick="solveFor('freq')">Solve ν</button>
  <button onclick="solveFor('B')">Solve B</button>
</div>

<script>
const muB = 9.2740100783e-24;
const h = 6.62607015e-34;
const conv = { mT: 1e-3, G: 1e-4, T: 1.0 };

function solveFor(target) {
  let g = parseFloat(gval.value);
  let freq = parseFloat(freq.value) * 1e9;
  let B = parseFloat(bfield.value) * conv[bunits.value];

  if (target === 'g') {
    g = (h * freq) / (muB * B);
    gval.value = g.toFixed(5);
  }
  else if (target === 'freq') {
    freq = (muB * g * B) / h;
    freq.value = (freq / 1e9).toFixed(5);
  }
  else if (target === 'B') {
    B = (h * freq) / (muB * g);
    let newB = B / conv[bunits.value];
    bfield.value = newB.toFixed(3);
  }
  updateDiagram();
}
</script>

<hr>

<h2>Zeeman + ZFS Energy Diagram (S = 1)</h2>
<div>
  <label>D (GHz): <input id="Dval" type="number" value="2.5" step="0.01"></label>
  <label>E (GHz): <input id="Eval" type="number" value="0" step="0.01"></label>
</div>
<div id="diagram" style="width:800px; height:500px;"></div>

<script>
function updateDiagram() {
  let g = parseFloat(gval.value);
  let D = parseFloat(Dval.value) * 1e9;
  let E = parseFloat(Eval.value) * 1e9;

  let Bvals = [...Array(200).keys()].map(i => i * 0.01); // 0–2 T

  const muB = 9.2740100783e-24;
  const h = 6.62607015e-34;

  let Ems1 = [], Em0 = [], Eps1 = [];

  for (let B of Bvals) {
    // S = 1 Hamiltonian (approx high-field):
    let Ze = muB * g * B;
    let ED = D/3;

    Ems1.push(-Ze + ED - E);
    Em0.push(-2*ED);
    Eps1.push(Ze + ED + E);
  }

  let data = [
    { x: Bvals, y: Ems1, name: "m = –1", mode: "lines" },
    { x: Bvals, y: Em0,  name: "m = 0",  mode: "lines" },
    { x: Bvals, y: Eps1, name: "m = +1", mode: "lines" }
  ];

  Plotly.newPlot("diagram", data, {
    xaxis: { title: "Magnetic Field (T)" },
    yaxis: { title: "Energy (J)" },
    title: "S = 1 Zeeman + ZFS Diagram",
  });
}

updateDiagram();
</script>

</body>
</html>
