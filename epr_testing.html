<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>EPR Resonance + Energy vs Field</title>
  <style>
    :root{--bg:#071027;--card:#071a2b;--muted:#9fb0c8;--accent:#7c3aed}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial; background:linear-gradient(180deg,#071027 0%, #07142a 60%); color:#e6eef6; margin:0; padding:20px}
    .wrap{max-width:980px;margin:0 auto}
    header{display:flex;align-items:center;gap:12px;margin-bottom:14px}
    h1{margin:0;font-size:20px}
    .grid{display:grid;grid-template-columns:1fr 420px;gap:16px}
    .card{background:rgba(255,255,255,0.03);border-radius:10px;padding:12px;box-shadow:0 6px 20px rgba(2,6,23,0.6)}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type=number], select{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
    .row{display:flex;gap:8px}
    button{background:var(--accent);border:none;color:white;padding:8px 12px;border-radius:8px;cursor:pointer}
    pre{background:rgba(0,0,0,0.25);padding:10px;border-radius:8px;overflow:auto}
    canvas{width:100%;height:360px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00))}
    .muted{color:var(--muted)}
    .small{font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>EPR Resonance — compute g, B, or ν and plot energy levels vs field</h1>
    </header>

    <div class="grid">
      <section class="card">
        <strong>Resonance calculator</strong>
        <p class="muted small">Use the resonance condition hν = g μB B. Fill any two values to compute the third. Frequency in GHz, field in mT.</p>

        <label>Microwave frequency ν (GHz)</label>
        <input id="freq" type="number" step="0.0001" placeholder="e.g. 9.5">

        <label>g-value</label>
        <input id="gval" type="number" step="0.0001" placeholder="e.g. 2.0023">

        <label>Resonance field B (mT)</label>
        <input id="field" type="number" step="0.0001" placeholder="e.g. 340.0">

        <div style="display:flex;gap:8px;margin-top:8px">
          <button onclick="computeMissing()">Compute missing</button>
          <button onclick="clearCalc()" style="background:#334155">Clear</button>
        </div>

        <div style="margin-top:10px">
          <pre id="calc_out">Enter any two of frequency, g, and field, then click Compute missing.</pre>
        </div>

        <hr style="margin:12px 0;border-color:rgba(255,255,255,0.04)">

        <strong>Unit conversions / options</strong>
        <label>Output units</label>
        <select id="units">
          <option value="mT">mT (millitesla)</option>
          <option value="T">T (tesla)</option>
          <option value="G">G (gauss)</option>
        </select>
        <div style="margin-top:8px"><small class="muted">Constants: h = Planck, μB = Bohr magneton. Isotropic g assumed.</small></div>
      </section>

      <section class="card">
        <strong>Energy levels vs Field (Zeeman)</strong>
        <p class="muted small">Simple Zeeman Hamiltonian H = g μB B S_z. Choose spin S and plot energy levels E_m(B). Energies shown in GHz and cm⁻¹. You can overlay transition energies (Δm = ±1) and mark the resonance field for the current microwave frequency.</p>

        <label>Spin S (e.g., 1/2, 1, 3/2, 2)</label>
        <input id="spinS" type="number" step="0.5" value="1/2">

        <label>g-value (for energy plot)</label>
        <input id="g_plot" type="number" step="0.0001" value="2.0023">

        <div class="row" style="margin-top:8px">
          <button onclick="drawEnergyPlot()">Draw energy vs B</button>
          <button onclick="clearPlot()" style="background:#334155">Clear</button>
        </div>

        <div style="margin-top:10px">
          <canvas id="energy_canvas" width="720" height="360"></canvas>
          <pre id="plot_out">Plot not drawn yet.</pre>
        </div>
      </section>

    </div>
  </div>

<script>
// Physical constants
const h = 6.62607015e-34; // J s
const hbar = h/(2*Math.PI);
const muB = 9.2740100783e-24; // J/T
const c = 299792458; // m/s
const kB = 1.380649e-23;
const cm_inv_J = 1.0/(h*c*100); // 1 J = ... cm^-1? Actually E (cm^-1) = E_J / (h*c*100) ?? We'll compute properly below.

function computeMissing(){
  const freq_in = document.getElementById('freq').value;
  const g_in = document.getElementById('gval').value;
  const field_in = document.getElementById('field').value;
  const units = document.getElementById('units').value;
  const filled = [freq_in!=="", g_in!=="", field_in!==""];
  const nfilled = filled.filter(x=>x).length;
  if(nfilled<2){ document.getElementById('calc_out').textContent = 'Please fill any two fields (ν and g, or ν and B, or g and B).'; return; }
  let freqGHz = freq_in!==""? parseFloat(freq_in): null;
  let g = g_in!==""? parseFloat(g_in): null;
  let B_mT = field_in!==""? parseFloat(field_in): null;
  // compute missing
  if(freqGHz===null){ // compute ν from g and B
    const B_T = convertBtoT(B_mT, units);
    const nu = (g*muB*B_T)/h; // Hz
    freqGHz = nu/1e9;
    document.getElementById('freq').value = freqGHz.toFixed(6);
  } else if(g===null){ // compute g from ν and B
    const B_T = convertBtoT(B_mT, units);
    const nu = freqGHz*1e9;
    g = (h*nu)/(muB*B_T);
    document.getElementById('gval').value = g.toFixed(6);
  } else if(B_mT===null){ // compute B from ν and g
    const nu = freqGHz*1e9;
    const B_T = (h*nu)/(g*muB);
    // convert to chosen units and set field
    const out = convertTtoB(B_T, units);
    document.getElementById('field').value = out.toFixed(6);
  }
  // prepare output display in all units
  const nu_Hz = freqGHz*1e9; const B_T_final = (h*nu_Hz)/(g*muB);
  const B_mT_final = B_T_final*1e3; const B_G = B_T_final*1e4;
  const outstr = `Computed values:\nν = ${freqGHz.toFixed(6)} GHz\ng = ${g.toFixed(6)}\nResonance field = ${B_T_final.toExponential(6)} T = ${B_mT_final.toFixed(4)} mT = ${B_G.toFixed(2)} G`;
  document.getElementById('calc_out').textContent = outstr;
}
function convertBtoT(val, units){ if(units==='T') return val; if(units==='mT') return val/1e3; if(units==='G') return val/1e4; return val; }
function convertTtoB(T, units){ if(units==='T') return T; if(units==='mT') return T*1e3; if(units==='G') return T*1e4; return T*1e3; }
function clearCalc(){ document.getElementById('freq').value=''; document.getElementById('gval').value=''; document.getElementById('field').value=''; document.getElementById('calc_out').textContent='Enter any two of frequency, g, and field, then click Compute missing.' }

// Energy vs field plotting
function drawEnergyPlot(){
  const S = parseFloat(document.getElementById('spinS').value);
  let gplot = parseFloat(document.getElementById('g_plot').value);
  if(isNaN(S) || isNaN(gplot)){ document.getElementById('plot_out').textContent='Enter numeric spin S and g.'; return; }
  const canvas = document.getElementById('energy_canvas'); const ctx = canvas.getContext('2d');
  const w = canvas.width; const h = canvas.height; ctx.clearRect(0,0,w,h);
  // m values
  const dim = Math.round(2*S+1);
  const mvals = []; for(let i=0;i<dim;i++) mvals.push(S - i);
  // field range: 0 to Bmax chosen from resonance with 35 GHz? better: choose 0 to 2x field for X-band 9.5 GHz and g
  // compute typical resonance field for 9.5 GHz
  const nu0 = 9.5e9; const Bres = (h*nu0)/(gplot*muB); // T
  const Bmax = Math.max(1.5*Bres, 0.1); // ensure nonzero
  const Bmin = 0;
  // sample fields
  const npoints = 200;
  const Bs = Array.from({length:npoints},(_,i)=>Bmin + (i/(npoints-1))*(Bmax-Bmin));
  // compute energies E_m(B) = g μB B m  (J)
  const energies = mvals.map(m=>Bs.map(B=>gplot*muB*B*m));
  // convert to preferred units: GHz (E/h) and cm^-1 (E/(h*c*100))
  const energies_GHz = energies.map(row=>row.map(EJ=>EJ/h/1e9));
  const energies_cminv = energies.map(row=>row.map(EJ=>EJ/(h*c*100)));
  // find global min/max for plotting
  let Eflat = energies_GHz.flat(); const Emin = Math.min(...Eflat); const Emax = Math.max(...Eflat);
  // draw axes
  ctx.strokeStyle='rgba(255,255,255,0.12)'; ctx.lineWidth=1; ctx.beginPath(); ctx.moveTo(50,20); ctx.lineTo(50,h-40); ctx.lineTo(w-20,h-40); ctx.stroke();
  ctx.fillStyle='rgba(160,176,200,0.9)'; ctx.font='12px sans-serif';
  // y-ticks
  const yticks = 6; for(let i=0;i<=yticks;i++){ const y = 20 + (i/yticks)*(h-60); const val = (Emax - (i/yticks)*(Emax-Emin)).toFixed(3); ctx.fillText(val + ' GHz', 6, y+4); ctx.beginPath(); ctx.moveTo(46,y); ctx.lineTo(50,y); ctx.stroke(); }
  // x-ticks
  const xticks = 6; for(let i=0;i<=xticks;i++){ const x = 50 + (i/xticks)*(w-70); const Bval = (Bmin + (i/xticks)*(Bmax-Bmin)); ctx.fillText((Bval*1e3).toFixed(2) + ' mT', x-18, h-22); ctx.beginPath(); ctx.moveTo(x,h-40); ctx.lineTo(x,h-36); ctx.stroke(); }

  // draw energy lines
  const palette = ['#7c3aed','#06b6d4','#10b981','#f97316','#ef4444','#a3e635'];
  energies_GHz.forEach((Erow,idx)=>{
    ctx.beginPath();
    for(let i=0;i<Erow.length;i++){ const x = 50 + (i/(Erow.length-1))*(w-70); const y = 20 + (1 - (Erow[i]-Emin)/(Emax-Emin))*(h-60); if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); }
    ctx.strokeStyle = palette[idx % palette.length]; ctx.lineWidth=2; ctx.stroke();
    // label left-side
    const y0 = 20 + (1 - (Erow[0]-Emin)/(Emax-Emin))*(h-60); ctx.fillText('m=' + mvals[idx], w-60, y0+4);
  });

  // overlay resonance line for current microwave frequency if set
  const freq_in = document.getElementById('freq').value;
  if(freq_in!==''){
    const nu = parseFloat(freq_in)*1e9;
    // For each pair of adjacent m -> m-1 transitions compute B where ΔE = hν → g μB B = hν/(Δm) ; For Δm=1, B_res = hν/(g μB)
    const BresT = (h*nu)/(gplot*muB);
    if(BresT<=Bmax*1.05){ // draw vertical line
      const x = 50 + ((BresT - Bmin)/(Bmax-Bmin))*(w-70);
      ctx.strokeStyle='rgba(255,230,0,0.9)'; ctx.lineWidth=1.5; ctx.beginPath(); ctx.moveTo(x,20); ctx.lineTo(x,h-40); ctx.stroke(); ctx.fillStyle='rgba(255,230,0,0.95)'; ctx.fillText('Resonance B = ' + (BresT*1e3).toFixed(3) + ' mT', x-60, 32);
    }
  }

  document.getElementById('plot_out').textContent = `Plotted E_m(B) for S=${S}, g=${gplot}. Field range 0 → ${(Bmax*1e3).toFixed(3)} mT. Energies shown in GHz.`;
}
function clearPlot(){ const c=document.getElementById('energy_canvas'); const ctx=c.getContext('2d'); ctx.clearRect(0,0,c.width,c.height); document.getElementById('plot_out').textContent='Plot not drawn yet.' }

</script>
</body>
</html>
