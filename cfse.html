<!DOCTYPE html>
<html lang="en">
<head>
    
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CFSE - Crystal Field Splitting Tool</title>
  <link rel="stylesheet" href="style.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
  <style>
    #controls {
      font-size: 14px;
      padding: 10px;
    }
    #controls input[type=range], #controls input[type=number], #controls select {
      width: 120px;
      margin: 5px;
    }
    #controls button {
      padding: 6px 10px;
      font-size: 14px;
    }
    .legend {
      font-size: 12px;
      margin-top: 10px;
    }
    .legend span {
      display: inline-block;
      width: 12px;
      height: 12px;
      margin-right: 5px;
      vertical-align: middle;
    }
  </style>
</head>
<body>
  <nav>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="about.html">About</a></li>
      <li><a href="contact.html">Contact</a></li>
      <li class="dropdown">
        <a href="#">Tools ▼</a>
        <ul class="dropdown-menu">
          <li><a href="nmrfreqs.html">NMR Frequencies</a></li>
          <li><a href="curieweiss.html">Curie-Weiss</a></li>
          <li><a href="unitconv.html">Unit Conversion</a></li>
          <li><a href="cfse.html">CFSE</a></li>
        </ul>
      </li>
    </ul>
  </nav>

  <div class="container">
    <h1>Crystal Field Splitting Tool</h1>
    <div class="controls" id="controls">
      <label>Geometry
        <select id="geom">
          <option value="oh">Octahedral</option>
          <option value="td">Tetrahedral</option>
          <option value="sp">Square Planar</option>
        </select>
      </label>
      <label>Δ (splitting, eV)
        <input id="delta" type="range" min="0" max="4" step="0.05" value="1.5">
      </label>
      <span id="deltaVal">1.50</span> eV
      <label>d-electron count
        <input id="dcount" type="number" min="0" max="10" value="6">
      </label>
      <label>Pairing energy (eV)
        <input id="pair" type="range" min="0" max="2" step="0.05" value="0.8">
      </label>
      <span id="pairVal">0.80</span> eV
      <div class="output">
        Spin state: <span id="spinState">—</span><br>
        CFSE: <span id="cfse">—</span><br>
        Pairs: <span id="pairs">—</span> | Unpaired: <span id="unpaired">—</span>
      </div>
      <button id="downloadCF">Download Diagram</button>
      <div class="legend">
        <span style="background:#4285f4"></span> Spin up
        <span style="background:#34a853; margin-left: 10px;"></span> Spin down
      </div>
    </div>

    <svg id="cftSVG" viewBox="0 0 700 450"></svg>
  </div>

  <script>
    const svg = document.getElementById('cftSVG');
    const deltaInput = document.getElementById('delta');
    const deltaVal = document.getElementById('deltaVal');
    const geomInput = document.getElementById('geom');
    const dcountInput = document.getElementById('dcount');
    const pairInput = document.getElementById('pair');
    const pairVal = document.getElementById('pairVal');
    const spinStateOutput = document.getElementById('spinState');
    const cfseOutput = document.getElementById('cfse');
    const pairsOutput = document.getElementById('pairs');
    const unpairedOutput = document.getElementById('unpaired');

    function getLevels(geom, Delta) {
      if (geom === 'oh') return [
        { label: '<tspan font-style="italic">t</tspan><tspan baseline-shift="sub" font-size="8">2g</tspan>', g: 3, E: -0.4*Delta },
        { label: '<tspan font-style="italic">e</tspan><tspan baseline-shift="sub" font-size="8">g</tspan>', g:2, E:0.6*Delta }
      ];
      if (geom === 'td') { const Dt=4/9*Delta; return [
        {label:'<tspan font-style="italic">e</tspan><tspan baseline-shift="sub" font-size="8">g</tspan>', g:2, E:-0.6*Dt},
        {label:'<tspan font-style="italic">t</tspan><tspan baseline-shift="sub" font-size="8">2</tspan>',g:3,E:0.4*Dt}
      ];}
      const E=[-0.35,-0.15,0.05,0.45].map(x=>x*Delta);
      return [
        {label:'dxz/yz',g:2,E:E[0]},{label:'dz2',g:1,E:E[1]},{label:'dxy',g:1,E:E[2]},{label:'dx2-y2',g:1,E:E[3]}
      ];
    }

    function fillElectrons(levels, n, P) {
      const subs=[];
      levels.forEach(L=>{ for(let i=0;i<L.g;i++) subs.push({E:L.E,label:L.label,occ:0}); });
      subs.sort((a,b)=>a.E-b.E);
      let rem=n;
      const highSpin=(Math.max(...levels.map(l=>l.E))-Math.min(...levels.map(l=>l.E)))<P;
      if(highSpin){ while(rem>0){ subs.sort((a,b)=> (a.occ-b.occ)||(a.E-b.E)); subs[0].occ++; rem--; } }
      else { for(const s of subs){ const add=Math.min(2,rem); s.occ+=add; rem-=add; if(rem<=0) break; } }
      let cfse=0,pairs=0,unpaired=0;
      subs.forEach(s=>{ cfse+=s.occ*s.E; if(s.occ===2) pairs++; else if(s.occ===1) unpaired++; });
      return {subs,cfse,pairs,unpaired,spin:highSpin?'High Spin':'Low Spin'};
    }

    function renderCFT(){
      const G=geomInput.value; const D=parseFloat(deltaInput.value); deltaVal.textContent=D.toFixed(2);
      const n=parseInt(dcountInput.value)||0; const P=parseFloat(pairInput.value)||0; pairVal.textContent=P.toFixed(2);
      const levels=getLevels(G,D); const filled=fillElectrons(levels,n,P);
      svg.innerHTML='';
      const W=700,H=450,yScale=120;

      // Y-axis for energy
      const yAxis=document.createElementNS('http://www.w3.org/2000/svg','line');
      yAxis.setAttribute('x1',100); yAxis.setAttribute('x2',100); yAxis.setAttribute('y1',50); yAxis.setAttribute('y2',H-50);
      yAxis.setAttribute('stroke','#333'); svg.appendChild(yAxis);

      const groups={};
      filled.subs.forEach(s=>{ groups[s.label]=groups[s.label]||[]; groups[s.label].push(s); });
      const uniq=Object.keys(groups).map(k=>({label:k,E:groups[k][0].E,arr:groups[k]})).sort((a,b)=>a.E-b.E);
      uniq.forEach((g,i)=>{
        const y=H/2 - g.E*yScale;
        const spacing=30;
        g.arr.forEach((s,idx)=>{
          const x=150 + idx*spacing;
          const line=document.createElementNS('http://www.w3.org/2000/svg','line');
          line.setAttribute('x1',x); line.setAttribute('x2',x); line.setAttribute('y1',y-12); line.setAttribute('y2',y+12);
          line.setAttribute('stroke','#333'); line.setAttribute('stroke-width','2'); svg.appendChild(line);
          if(s.occ>=1){ const c1=document.createElementNS('http://www.w3.org/2000/svg','circle'); c1.setAttribute('cx',x); c1.setAttribute('cy',y-4); c1.setAttribute('r',5); c1.setAttribute('fill','#4285f4'); svg.appendChild(c1); }
          if(s.occ>=2){ const c2=document.createElementNS('http://www.w3.org/2000/svg','circle'); c2.setAttribute('cx',x); c2.setAttribute('cy',y+4); c2.setAttribute('r',5); c2.setAttribute('fill','#34a853'); svg.appendChild(c2); }
        });
        const text=document.createElementNS('http://www.w3.org/2000/svg','text');
        text.setAttribute('x',50); text.setAttribute('y',y+5); text.setAttribute('fill','#333'); text.setAttribute('font-size','12');
        text.innerHTML = g.label;
        svg.appendChild(text);
        const energyText=document.createElementNS('http://www.w3.org/2000/svg','text');
        energyText.setAttribute('x',135); energyText.setAttribute('y',y+5); energyText.setAttribute('fill','#333'); energyText.setAttribute('font-size','12');
        energyText.textContent=g.E.toFixed(2)+' eV';
        svg.appendChild(energyText);
      });
      spinStateOutput.textContent=filled.spin;
      cfseOutput.textContent=filled.cfse.toFixed(2);
      pairsOutput.textContent=filled.pairs;
      unpairedOutput.textContent=filled.unpaired;
    }

    [geomInput, deltaInput, dcountInput, pairInput].forEach(el=>el.addEventListener('input',renderCFT));
    renderCFT();

    document.getElementById('downloadCF').addEventListener('click',()=>{
      const s=new XMLSerializer().serializeToString(svg);
      const blob=new Blob([s],{type:'image/svg+xml'});
      const url=URL.createObjectURL(blob);
      const a=document.createElement('a'); a.href=url; a.download='crystal_field.svg'; a.click(); URL.revokeObjectURL(url);
    });
  </script>
    <footer>
        <div class="container">
            <p>&copy; 2025 Euan Bassey. All rights reserved.</p>
        </div>
    </footer>
</body>
</html>
